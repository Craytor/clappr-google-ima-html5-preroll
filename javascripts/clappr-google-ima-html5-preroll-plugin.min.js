!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("clappr")):"function"==typeof define&&define.amd?define(["clappr"],t):"object"==typeof exports?exports.ClapprGoogleImaHtml5PrerollPlugin=t(require("clappr")):e.ClapprGoogleImaHtml5PrerollPlugin=t(e.Clappr)}(this,function(e){return function(e){function t(i){if(n[i])return n[i].exports;var A=n[i]={i:i,l:!1,exports:{}};return e[i].call(A.exports,A,A.exports,t),A.l=!0,A.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=7)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.mp4="data:video/mp4;base64, AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAGm1kYXQAAAGzABAHAAABthBgUYI9t+8AAAMNbW9vdgAAAGxtdmhkAAAAAMXMvvrFzL76AAAD6AAAACoAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAABhpb2RzAAAAABCAgIAHAE/////+/wAAAiF0cmFrAAAAXHRraGQAAAAPxcy++sXMvvoAAAABAAAAAAAAACoAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAgAAAAIAAAAAAG9bWRpYQAAACBtZGhkAAAAAMXMvvrFzL76AAAAGAAAAAEVxwAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAABaG1pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAShzdGJsAAAAxHN0c2QAAAAAAAAAAQAAALRtcDR2AAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAgACABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAAXmVzZHMAAAAAA4CAgE0AAQAEgICAPyARAAAAAAMNQAAAAAAFgICALQAAAbABAAABtYkTAAABAAAAASAAxI2IAMUARAEUQwAAAbJMYXZjNTMuMzUuMAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAAABAAAAAQAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAASAAAAAQAAABRzdGNvAAAAAAAAAAEAAAAsAAAAYHVkdGEAAABYbWV0YQAAAAAAAAAhaGRscgAAAAAAAAAAbWRpcmFwcGwAAAAAAAAAAAAAAAAraWxzdAAAACOpdG9vAAAAG2RhdGEAAAABAAAAAExhdmY1My4yMS4x",t.svg='data:image/svg+xml, <svg xmlns="http://www.w3.org/2000/svg" width="1" height="1" viewBox="0 0 1 1"><rect x="0" y="0" width="1" height="1" fill="#000000" /></svg>'},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var i=window,A=document,o=function(t){i.clearTimeout(r),"function"==typeof e&&e(t)};if(i.google&&i.google.ima)return void o(!0);var r=null,a=!0===t?"https:":"",s=A.getElementsByTagName("script")[0],l=A.createElement("script");l.src=a+"//imasdk.googleapis.com/js/sdkloader/ima3.js",l.async=!0,"function"==typeof e&&(l.onload=function(){o(!0)}),s.parentNode.insertBefore(l,s),n&&(r=i.setTimeout(function(){o(!1)},n))},e.exports=t.default},function(e,t,n){t=e.exports=n(8)(void 0),t.push([e.i,".google-ima-html5-preroll-plugin[data-preroll] {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  text-align: left; }\n  .google-ima-html5-preroll-plugin[data-preroll] .preroll-container[data-preroll] {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%; }\n  .google-ima-html5-preroll-plugin[data-preroll] .preroll-overlay[data-preroll] {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 1337;\n    background-color: #000;\n    cursor: pointer;\n    overflow: hidden;\n    display: none; }\n    .google-ima-html5-preroll-plugin[data-preroll] .preroll-overlay[data-preroll]:hover .preroll-overlay-icon[data-preroll] {\n      opacity: 1; }\n    .google-ima-html5-preroll-plugin[data-preroll] .preroll-overlay[data-preroll] .preroll-overlay-icon[data-preroll] {\n      position: relative;\n      width: 100%;\n      height: 25%;\n      top: 50%;\n      transform: translateY(-50%);\n      opacity: 0.75; }\n",""])},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function A(e){if(c===setTimeout)return setTimeout(e,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function o(e){if(u===clearTimeout)return clearTimeout(e);if((u===i||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(e);try{return u(e)}catch(t){try{return u.call(null,e)}catch(t){return u.call(this,e)}}}function r(){f&&p&&(f=!1,p.length?h=p.concat(h):g=-1,h.length&&a())}function a(){if(!f){var e=A(r);f=!0;for(var t=h.length;t;){for(p=h,h=[];++g<t;)p&&p[g].run();g=-1,t=h.length}p=null,f=!1,o(e)}}function s(e,t){this.fun=e,this.array=t}function l(){}var c,u,d=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(e){c=n}try{u="function"==typeof clearTimeout?clearTimeout:i}catch(e){u=i}}();var p,h=[],f=!1,g=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new s(e,t)),1!==h.length||f||A(a)},s.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.prependListener=l,d.prependOnceListener=l,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t){e.exports='<svg version="1.1" id="svg-spinner" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 80 80" xml:space="preserve"><path id="spinner" fill="#D43B11" d="M40,72C22.4,72,8,57.6,8,40C8,22.4, 22.4,8,40,8c17.6,0,32,14.4,32,32c0,1.1-0.9,2-2,2 s-2-0.9-2-2c0-15.4-12.6-28-28-28S12,24.6,12,40s12.6, 28,28,28c1.1,0,2,0.9,2,2S41.1,72,40,72z"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 40 40" to="360 40 40" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg>'},function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#010101" d="M1.425.35L14.575 8l-13.15 7.65V.35z"></path></svg>'},function(t,n){t.exports=e},function(e,t,n){"use strict";(function(i){function A(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function e(t,n,i){null===t&&(t=Function.prototype);var A=Object.getOwnPropertyDescriptor(t,n);if(void 0===A){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in A)return A.value;var r=A.get;if(void 0!==r)return r.call(i)},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=n(6),u=n(2),d=A(u),p=n(0),h=n(1),f=A(h),g=n(5),_=A(g),v=n(4),m=A(v),y=function(e){function t(e){o(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n._imaIsloaded=!1,n._imaLoadResult=!1,n._pluginIsReady=!1;var i=n.options.googleImaHtml5PrerollPlugin;i||n._pluginError("configuration is missing"),n._tag=i.tag,n._autostart=!1!==i.autostart,n._events=c.$.isPlainObject(i.events)?i.events:{};var A=i.imaLoadTimeout>0?i.imaLoadTimeout:6e3;return n._tag||n._pluginError("tag option is required"),(0,f.default)(function(e){n._imaLoadResult=e,n._imaIsloaded=!0,n._initImaSDK()},!0,A),n}return a(t,e),l(t,[{key:"name",get:function(){return"google-ima-html5-preroll-plugin"}},{key:"attributes",get:function(){return{class:this.name,"data-preroll":""}}}]),l(t,[{key:"bindEvents",value:function(){this.listenTo(this.core.mediaControl,c.Events.MEDIACONTROL_CONTAINERCHANGED,this._onMediaControlContainerChanged),this.listenTo(this.core,c.Events.CORE_READY,this._onCoreReady)}},{key:"_onMediaControlContainerChanged",value:function(){this.core.mediaControl.container.$el.append(this.el)}},{key:"_pluginError",value:function(e){throw new Error(this.name+": "+e)}},{key:"_onCoreReady",value:function(){this._container=this.core.getCurrentContainer(),this._container||this._pluginError("failed to get Clappr current container"),this._playback=this.core.getCurrentPlayback(),this._playback||this._pluginError("failed to get Clappr playback"),this._posterPlugin=this._container.getPlugin("poster"),this._clickToPausePlugin=this._container.getPlugin("click_to_pause"),this._contentElement=this._playback.el,this._initPlugin()}},{key:"_disableControls",value:function(){this.core.disableMediaControl(),this._posterPlugin&&this._posterPlugin.disable(),this._clickToPausePlugin&&this._clickToPausePlugin.disable(),this._container.stopListening()}},{key:"_enableControls",value:function(){this._clickToPausePlugin&&this._clickToPausePlugin.enable(),this._posterPlugin&&this._posterPlugin.enable(),this.core.enableMediaControl()}},{key:"_initPlugin",value:function(){var e=this;if("no_op"===this._playback.name)return void this.destroy();if("video"!==this._playback.tagName&&c.Browser.isMobile)return void this.destroy();this._$clickOverlay.show(),i.nextTick(function(){return e._disableControls()}),this._useDummyMp4Video=!1,this._useBlackSvgPixel=!1;var t=this._playback.el&&this._playback.el.src;t&&0!==t.length?"html5_video"!==this._playback.name||this._playback.el.hasAttribute("poster")||(this._playback.el.poster=p.svg,this._useBlackSvgPixel=!0):(this._playback.el.src=p.mp4,this._useDummyMp4Video=!0),this._pluginIsReady=!0,this._initImaSDK()}},{key:"_createImaContainer",value:function(){this._destroyImaContainer(),this._adContainer&&(this._imaContainer=document.createElement("div"),this._adContainer.appendChild(this._imaContainer))}},{key:"_destroyImaContainer",value:function(){this._imaContainer&&this._adContainer&&(this._adContainer.removeChild(this._imaContainer),delete this._imaContainer)}},{key:"_createAdDisplayContainer",value:function(){this._createImaContainer(),this._adDisplayContainer=new google.ima.AdDisplayContainer(this._imaContainer,this._contentElement)}},{key:"_initImaSDK",value:function(){if(this._imaIsloaded&&this._pluginIsReady){if(!this._imaLoadResult)return void this._playVideoContent();this._createAdDisplayContainer(),this._requestAd()}}},{key:"_requestAd",value:function(){var e=this,t=new google.ima.AdsLoader(this._adDisplayContainer);t.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(t){e._onAdsManagerLoaded(t)}),t.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(t){e._onAdError(t)});var n=new google.ima.AdsRequest;n.adTagUrl=this._tag,n.linearAdSlotWidth=this._contentElement.offsetWidth,n.linearAdSlotHeight=this._contentElement.offsetHeight,n.nonLinearAdSlotWidth=this._contentElement.offsetWidth,n.nonLinearAdSlotHeight=this._contentElement.offsetHeight,t.requestAds(n)}},{key:"_onAdsManagerLoaded",value:function(e){var t=this,n=new google.ima.AdsRenderingSettings;n.restoreCustomPlaybackStateOnAdBreakComplete=!1,this._adsManager=e.getAdsManager(this._contentElement,n),this._adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(e){t._onAdError(e)}),this._adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,function(){t._imaEvent("content_resume_requested"),t._playVideoContent()}),this._adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,function(){t._imaEvent("content_pause_requested")}),this._adsManager.addEventListener(google.ima.AdEvent.Type.LOADED,function(){t._imaEvent("loaded")}),this._adsManager.addEventListener(google.ima.AdEvent.Type.CLICK,function(){t._imaEvent("click")}),this._adsManager.addEventListener(google.ima.AdEvent.Type.IMPRESSION,function(){t._imaEvent("impression")}),this._adsManager.addEventListener(google.ima.AdEvent.Type.STARTED,function(){t._imaEvent("started")}),this._adsManager.addEventListener(google.ima.AdEvent.Type.FIRST_QUARTILE,function(){t._imaEvent("first_quartile")}),this._adsManager.addEventListener(google.ima.AdEvent.Type.MIDPOINT,function(){t._imaEvent("midpoint")}),this._adsManager.addEventListener(google.ima.AdEvent.Type.THIRD_QUARTILE,function(){t._imaEvent("third_quartile")}),this._adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE,function(){t._imaEvent("complete")}),this._adsManager.addEventListener(google.ima.AdEvent.Type.PAUSED,function(){t._imaEvent("paused")}),this._adsManager.addEventListener(google.ima.AdEvent.Type.RESUMED,function(){t._imaEvent("resumed")}),this._adsManager.addEventListener(google.ima.AdEvent.Type.SKIPPED,function(){t._imaEvent("skipped")}),this._adsManager.addEventListener(google.ima.AdEvent.Type.USER_CLOSE,function(){t._imaEvent("user_close")}),this._setupOverlay()}},{key:"_onAdError",value:function(e){this._imaEvent("ad_error",e),this._playVideoContent()}},{key:"_imaEvent",value:function(e,t){c.$.isFunction(this._events[e])&&this._events[e](t)}},{key:"_setupOverlay",value:function(){var e=this;if(!this._autostart||c.Browser.isMobile){var t=function t(n){try{e._clickOverlay.removeEventListener("click",t,!1),n.preventDefault(),n.stopPropagation()}catch(e){}e._$clickOverlay.hide(),e._playback.consent(),e._playAds()};return this._setPlayIcon(),void this._clickOverlay.addEventListener("click",t,!1)}this._$clickOverlay.hide(),this._playAds()}},{key:"_playAds",value:function(){this._adDisplayContainer.initialize();try{this._adsManager.init(this._contentElement.offsetWidth,this._contentElement.offsetHeight,google.ima.ViewMode.NORMAL),this._adsManager.start()}catch(e){this._imaEvent("error",e),this._playVideoContent()}}},{key:"_playVideoContent",value:function(){var e=this;i.nextTick(function(){e._enableControls(),e.$el.hide();var t=e.core.options.playback||{};t.recycleVideo=c.Browser.isMobile,e.core.configure({playback:t,sources:e.core.options.sources,autoPlay:!0})})}},{key:"_remove",value:function(){this._$adContainer&&this._$adContainer.remove(),this._$clickOverlay&&this._$clickOverlay.remove()}},{key:"render",value:function(){return this._remove(),this._$adContainer=(0,c.$)("<div />").addClass("preroll-container").attr("data-preroll",""),this._$clickOverlay=(0,c.$)("<div />").addClass("preroll-overlay").attr("data-preroll",""),this._$clickOverlay.append(m.default).find("svg path").css("fill","#fff"),this._$clickOverlay.find("svg").addClass("preroll-overlay-icon").attr("data-preroll",""),this.$el.append(this._$adContainer),this.$el.append(this._$clickOverlay),this.$el.append(c.Styler.getStyleFor(d.default)),this._adContainer=this._$adContainer[0],this._clickOverlay=this._$clickOverlay[0],this}},{key:"_setPlayIcon",value:function(){this._$clickOverlay.find("svg").replaceWith(_.default),this._$clickOverlay.find("svg path").css("fill","#fff"),this._$clickOverlay.find("svg").addClass("preroll-overlay-icon").attr("data-preroll","")}},{key:"destroy",value:function(){this._adsManager&&this._adsManager.destroy(),this._destroyImaContainer(),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}]),t}(c.UICorePlugin);t.default=y,e.exports=t.default}).call(t,n(3))},function(e,t){function n(e,t){var n=e[1]||"",A=e[3];if(!A)return n;if(t&&"function"==typeof btoa){var o=i(A);return[n].concat(A.sources.map(function(e){return"/*# sourceURL="+A.sourceRoot+e+" */"})).concat([o]).join("\n")}return[n].join("\n")}function i(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var i=n(t,e);return t[2]?"@media "+t[2]+"{"+i+"}":i}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},A=0;A<this.length;A++){var o=this[A][0];"number"==typeof o&&(i[o]=!0)}for(A=0;A<e.length;A++){var r=e[A];"number"==typeof r[0]&&i[r[0]]||(n&&!r[2]?r[2]=n:n&&(r[2]="("+r[2]+") and ("+n+")"),t.push(r))}},t}}])});